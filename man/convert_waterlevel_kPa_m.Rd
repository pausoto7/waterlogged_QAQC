% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/convert_wl_kpa_m.R
\name{convert_waterlevel_kPa_m}
\alias{convert_waterlevel_kPa_m}
\title{Convert water level pressure (kPa) to depth (meters)}
\usage{
convert_waterlevel_kPa_m(
  input_data,
  select_station,
  reference_data,
  reference_type = "stage",
  select_measurement = 1,
  logger_type_expected = "u20",
  path_to_output_folder
)
}
\arguments{
\item{input_data}{Data frame containing water level logger data with at
least \code{site_station_code}, \code{timestamp}, \code{waterpress_kPa}, and
\code{airpress_kPa} columns (typically from \code{\link[=add_nearest_baro]{add_nearest_baro()}}).}

\item{select_station}{Character; station code to process. Use \code{"all"} or
\code{NA} to process all stations in \code{input_data}.}

\item{reference_data}{Either a file path to a CSV containing manual reference
measurements or a data frame with columns \code{site_station_code}, \code{timestamp},
and either \code{stage_m} or \code{depth_m}.}

\item{reference_type}{Character; either \code{"stage"} or \code{"depth"} to indicate
which column in \code{reference_data} contains the reference water level.
Defaults to \code{"stage"}.}

\item{select_measurement}{Integer; which reference measurement to use when
multiple measurements exist for a station (defaults to 1, the first/closest).}

\item{logger_type_expected}{Character; expected logger type for validation
(defaults to \code{"u20"}). Used to check that pressure data are appropriate.}

\item{path_to_output_folder}{Directory where yearly v0.3 converted files will
be written (e.g., \code{"data/processed"}).}
}
\value{
A list with three elements:
\describe{
\item{[\link{1}] (site_wl)}{Data frame with converted water level in meters
(\code{waterlevel_m} column) plus all original columns.}
\item{[\link{2}] (ref_dat)}{Data frame of reference measurements used for
calibration.}
\item{[\link{3}] (wl_plot)}{Interactive plotly plot showing converted water
level time series with reference measurements overlaid.}
}
}
\description{
Converts absolute pressure readings from water level loggers (in kPa) to
water depth or stage (in meters) using manual reference measurements.
The function performs calibration by matching logger pressure readings to
known water levels at specific times, then applies the conversion to the
entire time series.
}
\details{
The function converts pressure to water level using the formula:
\deqn{waterlevel\_m = (waterpress\_kPa - airpress\_kPa) / 9.81}

Calibration adjusts this value to match reference measurements by calculating
an offset. When \code{select_station = "all"}, the function processes all stations
and returns combined results with a faceted QAQC plot.

Yearly v0.3 CSV files are written to
\verb{<path_to_output_folder>/<year>/processed/} with filenames of the form
\verb{<station>_WL_<startdate>_<enddate>_v0.3.csv}.
}
\seealso{
\code{\link[=add_nearest_baro]{add_nearest_baro()}}, \code{\link[=QAQC_reference_data]{QAQC_reference_data()}}, \code{\link[=convert_waterlevel_single]{convert_waterlevel_single()}}
}
